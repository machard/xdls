/*! xdls - v0.0.0 - 2014-04-03
* http://www.youtube.com/watch?v=cDuG95DXbw8
* Copyright (c) 2014 Obi-Wan Kenobi; Licensed  */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):a.xdls=b()}(this,function(){"use strict";var a,b,c=!1,d=!1,e=0,f=[],g=[],h=[],i={},j="*",k=function(d,e){if(c)throw"xdls already initialized";a=d.url,b=e;var f=document.createElement("a");f.href=a,j=f.protocol+"//"+f.hostname+(f.port?":"+f.port:""),l(),m()},l=function(){d=window.document.createElement("iframe"),d.style.position="absolute",d.style.left=d.style.top="-999",window.addEventListener?window.addEventListener("message",function(a){n(a)},!1):window.attachEvent("onmessage",function(a){n(a)}),window.document.body.appendChild(d),d.src=a},m=function(){var a=window.localStorage||{},b=function(a){return function(){if(!c)throw"You need to wait until ready callback has fired";return a.apply(null,arguments)}};a.setItem=b(r),a.getItem=b(s),a.removeItem=b(t)},n=function(a){if(a.origin===j){var e=JSON.parse(a.data);e.ready?(c=d.contentWindow,q({type:"init"})):e.init?(i=e.values,b()):(f[e._xds](e.val,e),o())}},o=function(){for(var a=0,b=g.length;b>a;a++)p(g[0]),g.shift()},p=function(a){return!c||h.indexOf(a.key)>=0?g.push(a):(e++,a._xds=e,h.push(a.key),f[e]=function(){h.splice(h.indexOf(a.key),1)},void q(a))},q=function(a){c.postMessage(JSON.stringify(a),j)},r=function(a,b){i[a]=b,p({type:"set",key:a,val:b})},s=function(a){return p({type:"get",key:a}),i[a]},t=function(a){delete i[a],p({type:"del",key:a})};return k});