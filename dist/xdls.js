/*! xdls - v0.0.0 - 2014-04-03
* http://www.youtube.com/watch?v=cDuG95DXbw8
* Copyright (c) 2014 Obi-Wan Kenobi; Licensed  */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):a.xdls=b()}(this,function(){"use strict";var a,b,c=!1,d=!1,e=0,f=[],g=[],h=[],i={},j=function(d,e){if(c)throw"xdls already initialized";a=d.url,b=e,k(),l()},k=function(){d=window.document.createElement("iframe"),d.style.position="absolute",d.style.left=d.style.top="-999",window.addEventListener?window.addEventListener("message",function(a){m(a)},!1):window.attachEvent("onmessage",function(a){m(a)}),window.document.body.appendChild(d),d.src=a},l=function(){var a=window.localStorage||{},b=function(a){return function(){if(!c)throw"You need to wait until ready callback has fired";return a.apply(null,arguments)}};a.setItem=b(p),a.getItem=b(q),a.removeItem=b(r)},m=function(a){var e=JSON.parse(a.data);e.ready===!0?(c=d.contentWindow,i=e.values,b()):(f[e._xds](e.val,e),n())},n=function(){for(var a=0,b=g.length;b>a;a++)o(g[0]),g.shift()},o=function(a){return!c||h.indexOf(a.key)>=0?g.push(a):(e++,a._xds=e,h.push(a.key),f[e]=function(){h.splice(h.indexOf(a.key),1)},void c.postMessage(JSON.stringify(a),"*"))},p=function(a,b){i[a]=b,o({type:"set",key:a,val:b})},q=function(a){return o({type:"get",key:a}),i[a]},r=function(a){delete i[a],o({type:"del",key:a})};return j});